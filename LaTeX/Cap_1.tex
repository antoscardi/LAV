\chapter{Introduction}
\label{intro}

\section{Previous Works}
In the context of S\&R\footnote{S\&R stands for Search and Rescue.} operations, 
the support of robots has become more and more extensive in recent years 
\cite{sr0},\cite{sr1} and in particular the necessity and advantages of using 
\textit{decentralized multi-agent} systems \cite{multiagent}. A particular field 
of S\&R missions focuses on high mountain scenarios, in which UAVs 
\footnote{UAV stands for Unmanned Aerial Vehicles.} are tasked with localizing 
avalanche victims. These missions involve the smart collaboration between UAVs 
and humans, developed also in the context of European founded projects such as 
the SHERPA one \cite{sherpa}. 

Different types of sensors can be used to achieve the localization goal, but the 
fastest and most accurate ones are electromagnetic sensors, which can operate 
also in noisy environments \cite{sensors}. Among these, the ARTVAs\footnote{ARTVA 
stands for the Italian “Apparecchio di Ricerca dei Travolti in VAlanga”.} are the 
most commonly used in both human-conducted and robot-conducted operations.

Many studies have analyzed and formulated strategies and algorithms in the 
particular context of S\&R operations using UAVs for avalanche victims 
\cite{main}, \cite{precedente}, \cite{pre-main}. Furthermore, in order to address 
the localization problem, the authors of \cite{similar-main} and 
\cite{first-model} propose a robocentric SLAM approach in the broader robotics 
context. Note that in \cite{similar-main} they also take into consideration the 
\textit{multiple victims} case.

Avalanche victims rescue missions are particularly difficult with respect to 
other S\&R operations because of some challenging aspects. In particular, the 
time constraint is quite demanding since the survival chances of avalanche 
victims diminish rapidly with time. Victims buried under avalanches have a 93\% 
survival rate within the first 15 minutes, which drops to 25\% after 45 minutes 
due to hypothermia \cite{survival} and plateaus at 21\% from 60 min to 180 
minutes \cite{survival2}.

The common human-conducted avalanche victims S\&R technique using ARTVA 
technology relies on three phases. In the first phase, rescuers search for the 
first valid electromagnetic signal, which can be detected at distances ranging 
from 20 meters for single-antenna receiver to 80 meters for triple-antenna ones. 
In the second phase, rescuers are trained to interpret the magnetic field data 
and follow standard procedures in order to follow magnetic field direction and 
find the victim's position. In the final phase, rescuers dig to save the buried 
individual.

Despite the effectiveness of this technique, it requires a significant amount of 
time due to the challenges of traversing avalanche terrain. Additionally, 
rescuers walking on unstable snow face the tangible risk of triggering a 
secondary avalanche \cite{first-model}. For these reasons, and given the 
additional advantage of typically not encountering obstacles in high mountain 
scenarios, the use of intelligent \textit{autonomous} drones results in a faster 
and safer search when compared to human rescuers, as shown in \cite{sr}, 
\cite{sr2}, \cite{sr3}.

Therefore, the aim of this work is to build upon previous efforts to 
\textit{automate} and improve the efficiency of the second phase by developing a 
mathematical/algorithmic framework for solving the localization problem of not 
just one, but \textit{multiple avalanche victims}, using \textit{multiple 
decentralized} agents (UAVs). This approach aims to reduce computational 
complexity without sacrificing accuracy and convergence time.

\subsection{Magnetic Dipole Localization}
In the context of a single magnetic source, numerous studies have focused 
on the localization task; in \cite{single_closed_formula_position} 
a straightforward closed-form solution is found by leveraging the analytical 
expressions of the magnetic field vector and the magnetic gradient tensor, 
regardless of the singularity of the magnetic gradient tensor matrix.

In the field of TMI\footnote{TMI stands for Total Magnetic Intensity} 
gradiend surveys, the acquisition of magnetic gradinet tensor data 
has seen significant advancements.
In \cite{NSS_analysis2}, new methods have been 
developed for inverting gradient tensor surveys, 
for a number of elementary, but useful, models. 
These include point pole, line 
of poles, point dipole (sphere), line of dipoles (horizontal cylinder), thin and thick 
dipping sheets, sloping step, and contact models.
A key insight is the use of eigenvalues and associated eigenvectors of the magnetic
tensor to obtain the NSS \footnote{NSS stands for Normalized Source Strength.},
which is a particularly useful rotational invariant that peaks 
directly over 2D sources, and it is independent of magnetization 
direction.

The NSS has been employed not only in geological applications, but also in the  
the detection, location, and classification of magnetic objects, such as naval 
mines, UXO, shipwrecks, archaeological artifacts, and buried drums \cite{NSS_analysis2}.

In \cite{NSS_formula_important}, the authors use the spatial relation between the 
magnetic target and observation points derived from the NSS for accurately locating 
a magnetic target, achieving nearly error-free results in the absence of noise.

In addition, methods that use the NSS for magnetic sources localization, for different models
and dimensions is done in \cite{NSS_single_different_dimensions}. 

In \cite{NSS_single_localization}, a key aspect of the NSS is identified by the fact
that it is only dependent on the distance between the source and target position;
since an analytical expression of the magnetic gradient tensor and a closed-form 
localization formula are derived.

In \cite{NSS_analysis} as well, it is stressed that the NSS is proportional 
to a constant normalized by the distance between observation and source. 
It is independent of magnetization direction and satisfies Euler’s homogeneity equation, 
this allows the authors to use Euler deconvolution of the NSS to estimate source location.  

\noindent
\\
Instead, the more specific multi-magnetic source localization task 
has been a difficult problem and different strategies have been conducted.

In recent years, many studies have performed an in-depth analysis on rotational 
invariants of the magnetic gradient tensor, such as \cite{multiple_plots} and 
\cite{multiple_real_plots_invariants}.
In the latter, a new method, named NED\footnote{NED stands for NEw Edge Detection} 
has been proposed, which is free from geomagnetic interference and provides 
abundant information, and it is compared with other methods such as the tilt angle 
(ratio of vertical to horizontal magnetic field components),
theta map, etc.

In this context of detecting and localizing multiple dipole-like 
magnetic sources, the authors of \cite{multiple_DE_NSS_big_matrix} 
use the magnetic gradient tensor data:
the tilt angle is used to determine the number of sources, 
while the rotational-invariant NSS is used to estimate the horizontal coordinates. 
Then, they employ the DE algorithm estimates the locations and moments of the sources.

Lastly, the authors of \cite{multiple_spacecraft} use 
the principal invariants of the magnetic field gradient tensor
to determine the number and horizontal location of the magnetic sources, 
while Euler equations are used to compute the sources's depth.

In our work, between all the different indicators in literature,
we chose to employ the NSS in order to estimate the 
horizontal coordinates of the avalanche victims, 
since it is rotationally invariant and completely isotropic 
around the magnetic dipole.
We are not interested in estimating the burial depth of the victims,
even if \cite{not_import_formula_z} use a closed loop formula to find z,
it cannot be applied to the multiple sources case.


\subsection{Particle Swarm Optimization}
In this context of simultaneous localization of multiple magnetic 
dipole sources, like in this real world application \cite{real_application}; 
different algorithms have been employed.
For instance, in \cite{DetectionMultiplMagnetiDipoleSources}, the authors
use a non-linear optimization method based on the Levenberg–Marquardt algorithm
to solve the problem, without the prior knowledge of the number of 
dipoles in the 3-D detection region.

In this work, we propose the use of the PSO\footnote{PSO stands for Particle Swarm Optimization.} 
algorithm as a mean to solve the multiple-sources localization task, 
which can be considered a continous multi-modal optimization problem.

The PSO\footnote{PSO stands for Particle Swarm Optimization.} algorithm 
was first introduced in 1995 \cite{PSO_original}, and it has since proven to be 
a simple but powerful tool for solving various optimization problems\cite{PSO_IMPORTANT},
among a lot of EAs \footnote{EA stands for Evolutionary Algorithm.}.
It has been used to solve various practical applications like simultaneous
localization of multiple odor souces \cite{12}, as well as decetion of acoustic 
\cite{PSO_acustic}, thermal, or chemical/biological signals \cite{3}.
In the standard PSO algorithm \cite{PSO_original}, a population of particles is 
randomly initialized to represent potential candidate solutions for the optimization problem. 
Each particle relies on two important pieces of information: its individual 
best, referred to as \textit{pbest}, and the global best across the entire population, 
referred to as \textit{gbest}. These two values guide the search direction of all particles over the search space. 
The evaluation of the \textit{pbest} for each particle and the \textit{gbest} for 
the entire population is determined by the function that needs to be optimized.

However, when addressing continuous optimization problems with numerous local optima, 
classical optimization algorithms often require strict conditions 
and extensive computation times \cite{PSO_another}.
For this reason, the authors of  \cite{PSO_IMPORTANT} introduced a modified PSO algorithm 
where the original population is divided into multiple subpopulations, 
according to the order of particles.
The best particle within each subpopulation is recorded and then 
used into the velocity updating formula to replace 
the original global best particle of thge entire population.
This strategy, based on the idea of multiple subpopulations, 
enables the algorithm to find several optima, including both
the global and local solutions, thanks to these distinct best particles
in each group.

Both in the standard PSO \cite{PSO_original} and the multi-swarm modification \cite{PSO_IMPORTANT}
common limitations are the premature convergence of the algorithm 
and its tendency to become trapped in some local optima.
Instead in \cite{PSO_another}, the authors overcome these issue,
including the one of poor population diversity. 
They introduce a modification to \cite{PSO_IMPORTANT}, it is called 
ADPSO\footnote{ADPSO stands for Adaptive Dynamic Multi-Swarm Particle Swarm Optimization.}, 
and includes features for stagnation detection and spatial exclusion to mitigate these challenges. 
The dynamic division of the population into sub-swarms, 
coupled with a regrouping mechanism, avoids stagnation during the optimization process. 
Stagnant sub-swarms are rejuvenated with a new generate particle, 
called the vitality particle, constructed from the historical information of the entire population. 
This approach maintains diversity and prevents sub-swarms from converging prematurely.

The authors of \cite{PSO_another2} focus their attention to the 
exploration and exploitaion aspects of the PSO algorithm, instead.
They enhance exploration and exploitation in a modified system,
named HCLPSO \footnote{HCLPSO stands for Heterogeneous Comprehensive 
Learning Particle Swarm Optimization.}, which divides the population 
into only two sub-swarms, one dedicated to exploitation and 
one dedicated to exploration. 
In the exploration-subpopulation, the solutions are generated by using the personal 
best experiences of the particles in the exploration-subpopulation itself. 
In the exploitation-subpopulation, the personal best experiences of the
entire swarm population are used to generate the solutions. 
In this way, since the exploration-subpopulation does not
learn from any particles in the other subpopulation, 
diversity is mantained in the exploration-subpopulation even when the 
exploitation-subpopulation converges prematurely.

\section{The ARTVA}
The ARTVA technology is composed of two different and easy switchable modalities: 
in \textit{receiver} mode, the instrument senses and processes the 
electromagnetic field emitted by the ARTVA \textit{transmitter} (carried by the 
avalanche victim).

The magnetic field generated by the solenoid antenna of the instrument oscillates 
with a frequency of 457 kHz and its characteristics are defined in the standard 
ETS 300 718-1 \cite{eu_standard}, to ensure compatibility between different 
brands and models. To save batteries and facilitate detection, the magnetic field 
is transmitted in pulses of a tenth of a second every second \cite{first-model}.

As will be discussed more in-depth in the following chapter, the magnetic field 
can be modeled as a three-dimensional vector field, which means that it assigns a 
certain intensity and direction to each point in space. Therefore, the main 
difference between different kinds of ARTVAs lies in \textit{"how much"} of this 
field they can measure. According to this criterion, the instruments can be 
divided into three different types \cite{first-model}:

\begin{itemize}
    \item ARTVAs \textit{with one reception antenna}: the oldest models, usually
    analog. The same antenna is used in both \textit{transmitter} and 
    \textit{receiver} mode. Therefore, only the projection of the magnetic field 
    on the antenna can be measured. This type of ARTVA is the most difficult to 
    use and the most time-consuming one.
    
    \item ARTVAs \textit{with two perpendicular reception antennas}: are based on 
    digital technology such as microprocessors. This type can measure only the 
    intensity and direction of the horizontal component of the field, only when 
    held in horizontal position.
    
    \item ARTVAs \textit{with three mutually perpendicular reception antennas}: 
    also based on digital technology. Since these ARTVAs possess three 
    perpendicular antennas, they can measure the complete vector field. For this 
    reason, the instrument can be oriented w.r.t the magnetic field in any way.
\end{itemize}

In this work, we will consider only new ARTVA transceivers (three antennas), 
which can achieve a search strip width in digital mode of 80 m and a maximum 
range in analog mode of 90 m \cite{manual}. Furthermore, it is important to point 
the transceiver in the direction of the avalanche, parallel to the slope. For 
this reason, in this work, two different types of trajectories have been 
considered.

\section{Gradient, Divergence, and Curl} \label{Gradient, Divergence, and Curl}
We briefly define the following operators which will be used throughout this 
work.

\subsection{Gradient of a Scalar Field}
\subsubsection{Definition}
Given a scalar function \( f(x_1, x_2, \ldots, x_n): \mathbb{R}^n \to \mathbb{R} 
\) or scalar field, the gradient of the function is a vector field of partial 
derivatives and denoted by \( \nabla f \), is defined as:
\begin{equation}
\nabla f = \left( \frac{\partial f}{\partial x_1}, \frac{\partial f}{\partial 
x_2}, \frac{\partial f}{\partial x_3}, \ldots, \frac{\partial f}{\partial x_n} 
\right)
\label{eq:gradient}
\end{equation}
where \( \nabla \) is the vector differential operator \cite{math-book}.

\subsubsection{Properties}
The gradient is a vector which points in the direction of the greatest ascent of 
the function and its magnitude is the increase.

\subsection{Definition of a Vector Field}
A \textbf{vector field} on a subset \(S \subseteq \mathbb{R}^n\) is a 
vector-valued function \(\mathbf{V}: S \to \mathbb{R}^n\) that assigns to each 
point \(\mathbf{x} = (x_1, x_2, \ldots, x_n) \in S\) a vector 
\(\mathbf{V}(\mathbf{x})\) \cite{math-book}.

\noindent
Note that from now on, we usually omit the spatial dipendence of vector fields
from points $\mathbf{x}$, since it's implied.

\subsection{Divergence of a Vector Field}
For simplicity and since we are working with \(\mathbb{R}^3\) Euclidean space, we 
limit our discussion from now on to Euclidean coordinates.

\subsubsection{Definition}
Given a vector field \(\mathbf{V}\), the divergence of \(\mathbf{V}\) at a point 
\( \mathbf{p} \in \mathbb{R}^3 \) is defined as the net outward flux of 
\(\mathbf{V}\) per unit volume \(\Delta v\) as the volume about the point tends 
to zero:
\begin{equation}
\nabla \cdot \mathbf{V} = \lim_{\Delta v \to 0} \frac{1}{\Delta v} \iint_S 
\mathbf{V} \cdot d\mathbf{s}
\label{eq:divergence}
\end{equation}
where \( \mathbf{V} \cdot d\mathbf{s} \) is the flux of \( \mathbf{V} \) through 
the surface \(S\) \cite{book-magnetism}.

Since \(\mathbf{V} = V_{x} \mathbf{e_x} + V_{y} \mathbf{e_y} + V_{z} 
\mathbf{e_z}\), the divergence of \(\mathbf{V}\), can be computed as:
\begin{equation}
\nabla \cdot \mathbf{V} = \frac{\partial V_{x}}{\partial x} + \frac{\partial 
V_{y}}{\partial y} + \frac{\partial V_{z}}{\partial z}
\end{equation}
where \(V_{x}\), \(V_{y}\), and \(V_{z}\) are the components of the vector field 
\(\mathbf{V}\) in the \(x\), \(y\), and \(z\) directions, respectively 
\cite{math-book}.

\subsubsection{Properties}
When the vector field is represented using flux lines (indicating the direction 
and intensity), the divergence is the amount of flux lines diverging/converging 
through a given point.

A net outward flux of a vector field through a surface bounding a volume 
indicates the presence of a source, the divergence measures the strength of the 
source. The divergence of a vector field is a scalar field. 

\subsection{Laplacian of a Vector Field}
The Laplacian of a vector field $\mathbf{V}$, denoted by $\nabla^2$, is similar 
to the scalar Laplacian and is defined as:
\begin{equation}
\nabla^2 V = \frac{\partial^2 V_x}{\partial x^2} + \frac{\partial^2 V_y}{\partial 
y^2} + \frac{\partial^2 V_z}{\partial z^2} \quad
\end{equation}

Alternatively, by taking the curl of the curl of a vector field, the Laplacian 
can be expressed as:
\begin{equation}
   \nabla^2 \mathbf{V} = \nabla (\nabla \cdot \mathbf{V}) - \nabla \times 
   (\nabla \times \mathbf{V})
   \label{eq:laplacian}
\end{equation}

\subsection{Curl of a Vector Field}
\subsubsection{Definition}
The curl of \(\mathbf{V}\), denoted by \(\nabla \times \mathbf{V}\), at a point in 
space \(\mathbf{x} \in \mathbb{R}^3\) is a vector field whose magnitude is the 
maximum net circulation of \(\mathbf{V}\) per unit area as the area tends to zero 
and whose direction is the normal direction of the area when the area is oriented 
to make the net circulation maximum:
\begin{equation}
\nabla \times \mathbf{V} = \lim_{\Delta s \to 0} \frac{1}{\Delta s} \mathbf{n} 
\oint_{C} \mathbf{V} \cdot d\mathbf{l}
\label{eq:curl}
\end{equation}
where \(\mathbf{n}\) is the unit normal vector to the surface \(S\), \(d\mathbf{l}\) 
is the differential line element along the boundary, and the integral represents 
the circulation of \(\mathbf{V}\) around the boundary of the surface 
\cite{book-magnetism}.

The curl of a vector field \(\mathbf{V}\) can be then computed in terms of its 
components \cite{math-book}:
\begin{equation}
\nabla \times \mathbf{V} = \left( \frac{\partial V_z}{\partial y} - \frac{\partial 
V_y}{\partial z}, \frac{\partial V_x}{\partial z} - \frac{\partial V_z}{\partial 
x}, \frac{\partial V_y}{\partial x} - \frac{\partial V_x}{\partial y} \right)
\label{eq:curl_calculation}
\end{equation}

\subsubsection{Properties}
Since the normal to an area can point in two opposite directions, the direction 
of the curl is given by the right-hand rule.
A vortex source causes a circulation of the vector field around it. The 
circulation of a vector field around a closed path is defined as the scalar line 
integral of the vector over the path. Note that a circulation of \(\mathbf{V}\) 
can exist even when the divergence of \(\mathbf{V}\) is zero, meaning there is no 
net source or sink.

\section{Stokes' Theorem} \label{Stokes' Theorem}
The surface integral of the curl of a vector field \(\mathbf{V}\) over a surface 
\( s \) is equal to the line integral of the vector field over the boundary 
contour \( c \) of the surface:
\begin{equation}
\oint_C \mathbf{V} \cdot d\mathbf{l} = \iint_S (\nabla \times \mathbf{V}) \cdot 
d\mathbf{s}
\label{eq:stokes}
\end{equation}
The proof of the theorem comes directly from the definition of the curl 
\ref{eq:curl} and by dividing the surface $S$ into smaller areas. The idea comes 
from the fact that computing the line integral around the boundary of a surface 
is equal to compute the integral for all the smaller areas, since the 
\(d\mathbf{l}\) components of the neighbouring regions are in opposite 
directions.

\section{Divergence Theorem}
The theorem states that the surface integral of a vector field \(\mathbf{V}\) 
over a closed surface \(S\) is equal to the volume integral of the divergence of 
\(\mathbf{V}\) over the volume enclosed by \(S\):
\begin{equation}
\iint_S\mathbf{V} \cdot d\mathbf{s} = \iiint_V (\nabla \cdot \mathbf{V}) \, dv
\label{eq:divergence_th}
\end{equation}

The idea of the proof is similar to \ref{Stokes' Theorem}, starting from the 
definition of the divergence \ref{eq:divergence}. Considering a volume divided 
into smaller volumes, the contributions from the internal surfaces cancel each 
other, leaving only the contribution from the outer surface.

\section{Null Identity Theorem}
The divergence of the curl of any vector field is always zero \cite{book-magnetism}:
\begin{equation}
\nabla \cdot (\nabla \times \mathbf{V}) = 0 
\label{eq:null}
\end{equation}
The proof leverages the divergence theorem \ref{eq:divergence_th} applied to the 
vector field \(\nabla \cdot (\nabla \times \mathbf{V})\). Considering that any 
volume can be divided in half, then the surface bounding the volume would be the 
sum of 2 surfaces, connected by a common boundary that has been drawn twice. One 
can then compute the two surface integrals using \ref{eq:stokes}, and since the 
two normals \(\mathbf{n}\) have equal intensity and opposite direction, their sum 
is zero and the integrand as well.

A converse statement of the theorem is as follows: 
If a vector field \(\mathbf{B}\) is divergence-less, then it can be expressed as 
the curl of another vector field \(\mathbf{V}\):
\[
\nabla \cdot \mathbf{B} = 0 \implies \mathbf{B} = \nabla \times \mathbf{V}
\]
Since the identity \(\nabla \cdot (\nabla \times \mathbf{V}) = 0\) always holds, 
it means that for any magnetic field \(\mathbf{B}\) with zero divergence, we can 
find a vector potential \(\mathbf{V}\) such that \(\mathbf{B}\) is the curl of 
\(\mathbf{V}\).

\section{Phasor Notation} \label{Phasor Notation}
For dealing with time-varying vector fields, we use phasor notation to represent 
sinusoidal varying field vectors (which is usually the case in real-world 
applications, such as the magnetic dipole) \cite{book-magnetism}. Phasor notation 
simplifies the analysis of such fields by converting differential equations into 
algebraic equations.

Then, an harmonic vector field \( \mathbf{V}(x, y, z, t) = \mathbf{V}(x, y, z) 
\, \cos\omega t\) can be represented by a vector phasor that depends on space 
coordinates but not on time:
\[
\mathbf{V}(x, y, z, t) = \mathbf{V}(x, y, z) e^{j\omega t}
\]
where \(\omega\) is the angular frequency and \( \mathbf{V}(x, y, z) \) is a 
vector phasor that contains information on direction, magnitude, and phase.

The time-domain function can be recovered from the phasor by taking the real part:
\[
\mathbf{V}(x, y, z, t) = \Re\{ \mathbf{V}(x, y, z) e^{j\omega t} \}
\]

\section{Spherical Coordinates} \label{Spherical Coordinates}
We define two classical coordinate systems: spherical coordinates \((r, \theta, 
\phi)\) and Cartesian coordinates \((x, y, z)\), with their respective vector 
basis \( \{\mathbf{e}_r, \mathbf{e}_{\theta}, \mathbf{e}_{\phi} \} \) and 
\( \{\mathbf{e}_x, \mathbf{e}_y, \mathbf{e}_z\} \), represented in Figure 
\ref{fig:coordinates}, from which the following relationships are evident. Note 
that we use the convention in \cite{main} for the angles and the axes. 

\begin{figure}
    \centering
    \tdplotsetmaincoords{70}{110}
	\pgfmathsetmacro{\thetavec}{48.17}
	\pgfmathsetmacro{\phivec}{63.5}
	
	\begin{tikzpicture}[tdplot_main_coords]
		%Axis
		\draw[axis] (0,0,0) -- (6.5,0,0) node [pos=1.1] {$y$};
		\draw[axis] (0,0,0) -- (0,6,0) node [pos=1.05] {$z$};
		\draw[axis] (0,0,0) -- (0,0,5.5)  node [pos=1.05] {$x$};   
		%Unit Vectors
		\tdplotsetcoord{P'}{7}{\thetavec}{\phivec}
    	\draw[univec] (0,0,0) -- (P') node [pos=1.05] {$\mathbf{e_r}$};
    	\tdplotsetcoord{P''}{1}{90}{90+\phivec}
    	\draw[univec] (2,4,0) -- ($(P'') + (2,4,0)$) node [pos=1.3] {$\mathbf{e_\phi}$};
    	\tdplotsetcoord{P'''}{1}{90+\thetavec}{\phivec}
    	\draw[univec] (2,4,4) -- ($(P''') + (2,4,4)$) node [pos=1.3] {$\mathbf{e_\theta}$};
		
		%Vectors
		\tdplotsetcoord{P}{6}{\thetavec}{\phivec}
		\draw[vec] (0,0,0) -- (P) node [midway, above] {$r$};
		\draw[thick] (0,0,0) -- (2,4,0);
		
		%Help Lines
		\draw[dashed] (2,4,4) -- (2,4,0);
		\draw[dashed] (2,0,0) -- (2,4,0) node [pos=-0.1] {};
		\draw[dashed] (0,4,0) -- (2,4,0) node [pos=-0.3] {};
		\draw[dashed] (0,0,4) -- (2,4,4) node [pos=-0.1] {};
		\draw[dashed, tdplot_main_coords] (4.47,0,0) arc (0:90:4.47);
		
		%Point
		\node[fill=black, circle, inner sep=0.8pt] at (2,4,4) {};
		
		%Angles
		\tdplotdrawarc{(0,0,0)}{0.7}{0}{\phivec}{below}{$\phi$}
		 
	    \tdplotsetthetaplanecoords{\phivec}
	    \tdplotdrawarc[tdplot_rotated_coords]{(0,0,0)}{0.5}{0}{\thetavec}{}{}
	    \node at (0,0.25,0.67) {$\theta$};
		
	\end{tikzpicture}
    \caption{Spherical and Cartesian coordinates with their respective unit 
    vectors.}
    \label{fig:coordinates}
\end{figure}

\subsection{Conversion from Cartesian to Spherical Coordinates} 
\label{Conversion from Cartesian to Spherical Coordinates}
\begin{align}
    r &= \sqrt{x^2 + y^2 + z^2}, \\
    \theta &= \cos^{-1} \left(\frac{\sqrt{z^2 + y^2}}{x}\right), \\
    \phi &= \tan^{-1} \left(\frac{y}{z}\right).
\end{align}

\subsection{Conversion from Cartesian to Spherical Coordinates} 
\label{Conversion from Spherical to Cartesian Coordinates}
\begin{align}
    x &= r \cos \theta, \\
    y &= r \sin \theta \cos \phi, \\
    z &= r \sin \theta \sin \phi.   
\end{align}

\subsection{Expressing Spherical Unit Vectors using Cartesian Unit Vectors}
A point $\mathbf{r}$ in Cartesian coordinates is given by:
\[
\mathbf{r} = x \, \mathbf{e}_x + y \, \mathbf{e}_y + z \, \mathbf{e}_z.
\]
The radial unit vector \( \mathbf{e}_r \) is defined as the normalized position 
vector, obtained by substituting the coordinates in 
\ref{Conversion from Cartesian to Spherical Coordinates}:
\begin{equation}
\mathbf{e}_r = \frac{\mathbf{r}}{|\mathbf{r}|} = \cos\theta \, \mathbf{e}_x + 
\sin\theta \cos\phi \, \mathbf{e}_y + \sin\theta \sin\phi  \, \mathbf{e}_z.
\label{e_r}
\end{equation}
The unit vector \( \mathbf{e}_\theta \), which is perpendicular to \( 
\mathbf{e}_r \) and lies in the plane formed by the origin and the \( z \)-axis, 
points in the direction of increasing \( \theta \). It can be found by taking the 
partial derivative of the position vector with respect to \( \theta \) and 
normalize it:
\begin{equation}
\mathbf{e}_\theta = -\sin\theta \, \mathbf{e}_x + \cos\theta \cos\phi \, 
\mathbf{e}_y + \cos\theta \sin\phi \, \mathbf{e}_z.
\label{e_theta}
\end{equation}
Similarly, the unit vector \( \mathbf{e}_\phi \), which is perpendicular to both 
\( \mathbf{e}_r \) and \( \mathbf{e}_\theta \), points in the direction of 
increasing \( \phi \). It can be derived by taking the partial derivative of the 
position vector with respect to \( \phi \) and normalize it:
\[
\mathbf{e}_\phi = \frac{\frac{\partial \mathbf{r}}{\partial 
\phi}}{|\frac{\partial \mathbf{r}}{\partial \phi}|} = - \sin\phi  \, \mathbf{e}_y 
+ \cos\phi \, \mathbf{e}_z.
\]

\subsection{The Gradient, Divergence, and Curl in Spherical Coordinates}
We omit the demonstration of how these formulas are found starting from the 
definitions given in Cartesian coordinates \ref{Gradient, Divergence, and Curl}, 
which involve large amount of computations \cite{book-magnetism}.

For a vector field expressed in spherical coordinates:
\[
\mathbf{V} = V_r \mathbf{e}_R + V_\theta \mathbf{e}_{\theta} + V_\phi \mathbf{e}_\phi 
\]
the divergence is:
\begin{equation}
\nabla \cdot \mathbf{V} = \frac{1}{r^2} \frac{\partial}{\partial r} (r^2 V_r) + 
\frac{1}{r \sin \theta} \frac{\partial}{\partial \theta} (\sin \theta V_\theta) 
+ \frac{1}{r \sin \theta} \frac{\partial V_\phi}{\partial \phi}.
\end{equation}
The curl in spherical coordinates is:
\begin{equation}
\nabla \times \mathbf{V} = \frac{1}{r \sin \theta} \begin{vmatrix} 
    \mathbf{e}_r & r  \mathbf{e}_\theta & r \sin \theta  \mathbf{e}_\phi \\ 
    \frac{\partial}{\partial r} & \frac{\partial}{\partial \theta} & 
    \frac{\partial}{\partial \phi} \\ 
    V_r & r V_\theta & r \sin \theta V_\phi 
    \end{vmatrix}.
    \label{curl_spher}
\end{equation}
carrying out the determinant:
\begin{equation}
\begin{aligned}
\nabla \times \mathbf{V} = \frac{1}{r \sin \theta} \Bigg[ 
    \left( \frac{\partial}{\partial \theta} (V_\phi \sin \theta) - 
    \frac{\partial V_\theta}{\partial \phi} \right)  &\mathbf{e}_r \\
    + \left( \frac{1}{\sin \theta} \frac{\partial V_r}{\partial \phi} - 
    \frac{\partial}{\partial r} (r V_\phi) \right)  &\mathbf{e}_\theta \\
    + \left( \frac{\partial}{\partial r} (r V_\theta) - \frac{\partial V_r}{\partial 
    \theta} \right)  &\mathbf{e}_\phi 
\Bigg].
\end{aligned}
\end{equation}

\section{3D Dirac Delta}
\subsubsection{Definition}
Given a point \(\mathbf{r}\) in Cartesian coordinates, the Dirac delta function 
\(\delta(\mathbf{r})\) is defined as \cite{book-magnetism2}:
\begin{itemize}
    \item \(\delta(\mathbf{r}) = 0\) at all points except at \(\mathbf{r} = 
    (0,0,0)\).
    \item The integral across the entire space satisfies:
    \begin{equation}
    \int_V \delta(\mathbf{r}) \, dv = 1
    \label{eq:dirac}
    \end{equation}
\end{itemize}

The result of the integral could be the value of any function in zero, $f(0)$.
For example, the Dirac delta could be the charge density $\rho$ \ref{tab:symbols} 
of a point particle located at the origin whose charge is \(q\).

\section{Green's Function for Poisson Equation}
Poisson's equation using Green's function is written as:
\begin{equation}
\nabla^2 G(\mathbf{r}) = \delta(\mathbf{r})
\label{eq:poisson}
\end{equation}
The solution to the above equation is given by:
\[
G(r) =  - \frac{1}{4 \pi r}
\]
\subsubsection{Proof}
We assume \(G(r)\) to be axis-symmetric, implying that it only depends on the 
magnitude $r$, not the vector position $\mathbf{r}$.
Considering the point \((x,y,z)\) and the distance \(r\) from the origin.
To find Green function we look for the simplest function that satisfies the 
equation, which has the form:
\[
G(r) = A \frac{1}{r} + B
\]
where \(A\) and \(B\) are constants. 

Assuming \(B = 0\) for simplicity, we find \(A\) by integrating over a sphere of 
volume $\epsilon$.
Substituting Poisson's equation \ref{eq:poisson} in the the definition of the 
Dirac delta \ref{eq:dirac}:
\[
\int_V \nabla^2 G(r) \, dv = 1 
\]
Using the divergence theorem \ref{eq:divergence_th}:
\[
\int_V \nabla^2 G(r) \, dv = \int_S \nabla G(r) \cdot d\mathbf{s} 
\]
\[
1 = \int_S \nabla G(r) \cdot d\mathbf{s} 
\]
The right-hand side represents the flux through the surface \(S\). We take the 
integral over the surface of a sphere of radius \(r\), knowing that the surface 
area is \(4 \pi r^2\) and computing the divergence (which is just the derivative 
thanks to the assumption) of $A \, \frac{1}{r}$:
\[
1 = \int_S - \frac{A}{r^2} d\mathbf{s} = - \frac{4 \pi \slashed{r^2} 
A}{\slashed{r^2}}
\]
From which we conclude:
\[
A = - \frac{1}{4 \pi}
\]
